<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project | Rohan Giriraj</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="assets/js/transitions.js" defer></script>
    <!-- Markdown Support -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</head>

<body>

    <div class="glow"></div>

    <!-- Navigation Dock -->
    <div class="nav-container">
        <nav>
            <a href="index.html" class="nav-item">Home</a>
            <a href="projects.html" class="nav-item active">Work</a>
            <a href="blog.html" class="nav-item">Thoughts</a>
            <a href="cv.html" class="nav-item">CV</a>
        </nav>
    </div>

    <div class="wrapper">
        <a href="projects.html" class="back-link" id="backLink">← Back to Work</a>

        <article class="project-content">
            <div class="project-header">
                <h1 id="projectTitle"></h1>
                <div class="project-meta">
                    <span class="project-status" id="projectStatus"></span>
                    <span class="project-tech" id="projectTech"></span>
                </div>
            </div>
            <div id="projectBody"></div>
        </article>
    </div>

    <script>
        // Configure marked options
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // Get URL parameters
        const params = new URLSearchParams(window.location.search);
        const projectSlug = params.get('project');
        const fromPage = params.get('from');

        // Set up back link intelligently
        const backLink = document.getElementById('backLink');
        if (fromPage) {
            // User came from a paginated view
            backLink.href = `projects.html?view=all&page=${fromPage}`;
            if (fromPage !== '1') {
                backLink.textContent = `← Back to Work (Page ${fromPage})`;
            }
        } else {
            // User came from featured view or direct link
            backLink.href = 'projects.html';
        }

        async function loadProject() {
            if (!projectSlug) {
                document.getElementById('projectTitle').textContent = 'Project Not Found';
                document.getElementById('projectBody').innerHTML = '<p>No project specified.</p>';
                return;
            }

            try {
                // Load projects metadata
                const projectsResponse = await fetch('projects.json');
                const projects = await projectsResponse.json();

                // Find the project metadata
                const project = projects.find(p => p.slug === projectSlug);

                if (!project) {
                    document.getElementById('projectTitle').textContent = 'Project Not Found';
                    document.getElementById('projectBody').innerHTML = '<p>Could not find this project.</p>';
                    return;
                }

                // Update page title and project metadata
                document.title = `${project.title} | Rohan Giriraj`;
                document.getElementById('projectTitle').textContent = project.title;
                document.getElementById('projectStatus').textContent = project.status;
                document.getElementById('projectTech').textContent = project.techStack.join(', ');

                // Load and render markdown content
                // Use slug as filename (projects are stored as slug.md)
                const fileName = project.file || `${project.slug}.md`;
                const contentResponse = await fetch(`content/projects/${fileName}`);
                const markdown = await contentResponse.text();

                // Convert markdown to HTML
                const html = marked.parse(markdown);
                document.getElementById('projectBody').innerHTML = html;

            } catch (error) {
                console.error('Error loading project:', error);
                document.getElementById('projectTitle').textContent = 'Error Loading Project';
                document.getElementById('projectBody').innerHTML = '<p>Failed to load project content.</p>';
            }
        }

        // Load project on page load
        loadProject();
    </script>
</body>

</html>